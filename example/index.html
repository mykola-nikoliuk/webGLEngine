<!DOCTYPE html>
<html>
<head>
    <title>webGL</title>
    <meta charset="utf-8">
</head>
<body>

<script id="shader-fs-old" type="x-shader/x-fragment">
    precision mediump float;

    varying vec4 vColor;
    varying vec2 vTextureCoord;
    varying vec3 vTransformedNormal;
    varying vec4 vPosition;

    uniform float uMaterialSpecular;

    uniform bool uUseLighting;
    uniform bool uUseLight[16];
    uniform bool uUseTexture;

    uniform vec3 uLightPosition[16];
    uniform vec3 uLightColor[16];
    uniform float uLightDistance[16];

    uniform sampler2D uSampler;

    vec3 avarage (vec3 a, vec3 b) {
      return vec3((a.r + b.r) / 2.0, (a.g + b.g) / 2.0, (a.b + b.b) / 2.0);
    }

    void main(void) {
        vec3 lightWeighting[16];
        vec4 totalColor = uUseTexture ? texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t)) : vColor;
        vec3 lightColor = vec3(1, 1, 1);

        if (uUseLighting) {
            lightColor = vec3(0, 0, 0);
            for (int i = 0; i < 3; i++) {
                if (uUseLight[i]) {
                    float distanceLight = distance(uLightPosition[i], vPosition.xyz);
                    vec3 lightDirection = normalize(uLightPosition[i] - vPosition.xyz);
                    vec3 normal = normalize(vTransformedNormal);

                    float distanceLightWeighting = 1.0 - distanceLight / uLightDistance[i];

                    float diffuseLightWeighting = max(dot(lightDirection, normal), 0.0);
                    lightWeighting[i] = vec3(1, 1, 1) * diffuseLightWeighting * distanceLightWeighting;

                    if (uMaterialSpecular != 0.0) {
                        float specularLightWeighting = 0.0;
                        vec3 eyeDirection = normalize(-vPosition.xyz);
                        vec3 reflectionDirection = reflect(-lightDirection, normal);
                        specularLightWeighting = pow(max(dot(reflectionDirection, eyeDirection), 0.0), uMaterialSpecular);
                        lightWeighting[i] += uLightColor[i] * specularLightWeighting;
                    }

                    if (lightWeighting[i].r < 0.0) lightWeighting[i].r = 0.0;
                    if (lightWeighting[i].g < 0.0) lightWeighting[i].g = 0.0;
                    if (lightWeighting[i].b < 0.0) lightWeighting[i].b = 0.0;

                    lightColor += uLightColor[i] * lightWeighting[i];
                }
            }
            totalColor = vec4(totalColor.rgb * lightColor, totalColor.a);
        }

        gl_FragColor = vec4(totalColor.rgb, totalColor.a);
    }

</script>

<script id="shader-vs-old" type="x-shader/x-vertex">
    attribute vec3 aVertexPosition;
    attribute vec3 aVertexNormal;
    attribute vec4 aVertexColor;
    attribute vec2 aTextureCoord;

    uniform mat4 uMVMatrix;
    uniform mat4 uPMatrix;
    uniform mat3 uNMatrix;

    varying vec4 vColor;
    varying vec2 vTextureCoord;
    varying vec3 vTransformedNormal;
    varying vec4 vPosition;

    void main(void) {
        vPosition = uMVMatrix * vec4(aVertexPosition, 1.0);
        gl_Position = uPMatrix * vPosition;
        vColor = aVertexColor;
        vTextureCoord = aTextureCoord;
        vTransformedNormal = uNMatrix * aVertexNormal;
    }
</script>

<div id="fps" style="position: absolute; z-index: 99"></div>

<script src="js/libs/utils.js"></script>
<script src="js/libs/class.js"></script>
<script src="js/libs/webClient.js"></script>
<script src="webGLEngine/webGLEngine.js"></script>
<script src="js/main.js"></script>
<script src="js/game.js"></script>
<script src="js/config.js"></script>

</body>
</html>
